<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CircularMidiGenerator.ViewModels"
        xmlns:controls="using:CircularMidiGenerator.Controls"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
        x:Class="CircularMidiGenerator.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="ðŸŽµ Circular MIDI Generator"
        Width="1000" Height="700"
        Background="#1A0B2E"
        MinWidth="800" MinHeight="600">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#2A1B3D" Foreground="White">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}"/>
                <MenuItem Header="_Open..." Command="{Binding LoadConfigurationCommand}"/>
                <MenuItem Header="_Save" Command="{Binding SaveConfigurationCommand}"/>
                <MenuItem Header="E_xit"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="Select _All Markers" Command="{Binding SelectAllMarkersCommand}"/>
                <MenuItem Header="_Clear All Markers" Command="{Binding ClearAllMarkersCommand}"/>
            </MenuItem>
            <MenuItem Header="_Playback">
                <MenuItem Header="{Binding PlayButtonText}" Command="{Binding PlayToggleCommand}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Show _Grid" Command="{Binding ToggleQuantizationCommand}"/>
            </MenuItem>
        </Menu>
        
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>
        
            <!-- Main Content Area -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Top Control Panel -->
                <Border Grid.Row="0" Background="#2A1B3D" CornerRadius="15" BorderBrush="#FF6B9D" BorderThickness="2" Padding="15" Margin="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Top Row: Playback and Settings -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="20" HorizontalAlignment="Center" Margin="0,0,0,10">
                            <!-- Playback Controls -->
                            <Button Content="{Binding PlayButtonText}"
                                    Command="{Binding PlayToggleCommand}"
                                    Background="{Binding PlayButtonColor}"
                                    Foreground="White"
                                    Padding="20,10"
                                    CornerRadius="25"/>

                            <!-- BPM Control -->
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="BPM:" VerticalAlignment="Center" Foreground="White" FontWeight="Bold"/>
                                <NumericUpDown Value="{Binding BPMDecimal, Mode=TwoWay}" 
                                               Minimum="60" 
                                               Maximum="200" 
                                               Width="100"
                                               Height="35"
                                               Increment="1"
                                               FormatString="F0"
                                               Background="#44318D"
                                               Foreground="White"
                                               FontSize="14"
                                               FontWeight="Bold"
                                               HorizontalContentAlignment="Center"
                                               VerticalContentAlignment="Center"
                                               BorderBrush="#FF6B9D"
                                               BorderThickness="2"
                                               CornerRadius="8"
                                               x:Name="BpmNumericUpDown"/>
                            </StackPanel>

                            <!-- MIDI Device Selection -->
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <TextBlock Text="MIDI Out:" VerticalAlignment="Center" Foreground="White" FontWeight="Bold"/>
                                <ComboBox x:Name="MidiDeviceComboBox"
                                          Width="180"
                                          Height="35"
                                          Background="#44318D"
                                          Foreground="White"
                                          BorderBrush="#4ECDC4"
                                          BorderThickness="2"
                                          CornerRadius="8"
                                          FontSize="12"
                                          VerticalContentAlignment="Center"/>
                                <Button Content="ðŸ”„" 
                                        Width="35" Height="35"
                                        Background="#4ECDC4"
                                        Foreground="White"
                                        BorderThickness="0"
                                        CornerRadius="8"
                                        ToolTip.Tip="Refresh MIDI Devices"
                                        x:Name="RefreshMidiButton"/>
                            </StackPanel>

                            <!-- Quantization -->
                            <CheckBox Content="Quantize" 
                                      IsChecked="{Binding IsQuantizationEnabled}"
                                      Foreground="White"/>
                        </StackPanel>
                        
                        <!-- Bottom Row: File Operations -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="15" HorizontalAlignment="Center">
                            <Button Content="ðŸ’¾ Save" 
                                    Command="{Binding SaveConfigurationCommand}"
                                    Background="#4ECDC4"
                                    Foreground="White"
                                    Padding="20,8"
                                    CornerRadius="20"
                                    FontWeight="Bold"/>
                            
                            <Button Content="ðŸ“ Load" 
                                    Command="{Binding LoadConfigurationCommand}"
                                    Background="#FFD23F"
                                    Foreground="White"
                                    Padding="20,8"
                                    CornerRadius="20"
                                    FontWeight="Bold"/>

                            <Button Content="ðŸ—‘ï¸ Reset" 
                                    Command="{Binding ClearAllMarkersCommand}"
                                    Background="#FF6B6B"
                                    Foreground="White"
                                    Padding="20,8"
                                    CornerRadius="20"
                                    FontWeight="Bold"/>
                                    
                            <Button Content="ðŸ›‘ Stop All Notes" 
                                    Command="{Binding StopAllNotesCommand}"
                                    Background="#FF8E53"
                                    Foreground="White"
                                    Padding="20,8"
                                    CornerRadius="20"
                                    FontWeight="Bold"
                                    ToolTip.Tip="Emergency stop for all MIDI notes"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Main Canvas Area -->
                <Border Grid.Row="1" Margin="10" CornerRadius="25" BorderBrush="#FF6B9D" BorderThickness="3" Background="#0F0A1A">
                    <Grid>
                        <!-- Circular Canvas Control -->
                        <controls:CircularCanvas x:Name="CircularCanvas"
                                               HorizontalAlignment="Stretch"
                                               VerticalAlignment="Stretch"
                                               Margin="30"/>
                        
                        <!-- Instructions -->
                        <Border HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,30"
                                Background="#2A1B3D" CornerRadius="15" Padding="20,10" BorderBrush="#FF6B9D" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="âœ¨ Click to place markers â€¢ Drag to move â€¢ Drag outside to remove âœ¨" 
                                           Foreground="White"
                                           TextAlignment="Center"
                                           Margin="0,0,0,5"/>
                                <TextBlock Text="ðŸŽ›ï¸ Right-click + drag: â†•ï¸ Velocity â€¢ â†”ï¸ Note Length" 
                                           Foreground="#FFD23F"
                                           TextAlignment="Center"
                                           FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>

                <!-- Status Bar -->
                <Border Grid.Row="2" Background="#2A1B3D" BorderBrush="#FF6B9D" BorderThickness="0,2,0,0" Padding="20,12" Margin="10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                   Text="{Binding StatusMessage}" 
                                   Foreground="White" 
                                   VerticalAlignment="Center"/>
                        
                        <TextBlock Grid.Column="1" 
                                   Text="{Binding PlayheadAngle, StringFormat='ðŸŽ¯ {0:F1}Â°'}" 
                                   Foreground="#FFD23F" 
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Lane Management Panel -->
            <Border Grid.Column="1" Background="#2A1B3D" BorderBrush="#FF8E53" BorderThickness="3,0,0,0" Margin="0,10,10,10">
                <controls:LanePanel DataContext="{Binding}"/>
            </Border>
        </Grid>
    </Grid>
</Window>